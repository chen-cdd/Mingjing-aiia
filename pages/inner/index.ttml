<view class="page">
  <!-- å†…å®¹åŒºï¼šæ ¹æ®åº•éƒ¨å¯¼èˆªçš„ tab åˆ‡æ¢ -->
  <view class="content">

    <!-- è¿‡å» -->
    <view tt:if="{{tab==='past'}}" class="section">
      <view class="section-title"><text class="title-dot"></text>æƒ…ç»ªäº‘å›¾</view>
      <view class="cloud">
        <block tt:for="{{cloud}}" tt:key="name">
          <view class="chip cloud-chip" style="transform:scale({{item.scale}})">{{item.name}}</view>
        </block>
      </view>

      <view class="section-title" style="margin-top:18rpx;"><text class="title-dot"></text>æ—¶é—´çº¿</view>
      <view class="timeline">
        <block tt:for="{{timeline}}" tt:key="id">
          <view class="card item">
            <view class="time">{{item.time}}</view>
            <view class="summary">{{item.summary}}</view>
            <view class="chips" style="margin-top:8rpx;">
              <block tt:for="{{item.topics}}" tt:key="*this">
                <view class="chip">#{{item}}</view>
              </block>
            </view>
          </view>
        </block>
      </view>
    </view>

    <!-- ä»Šå¤© -->
    <view tt:elif="{{tab==='today'}}" class="section">
      <view class="section-title"><text class="title-dot"></text>ä»Šæ—¥æŠ€èƒ½å¡</view>
      <scroll-view scroll-x="true" class="skills">
        <block tt:for="{{skills}}" tt:key="id">
          <view class="skill">
            <view class="skill-title">{{item.title}}</view>
            <view class="subtle">{{item.meta}}</view>
            <view class="btn-primary" style="margin-top:12rpx" data-id="{{item.id}}" bindtap="practice">ç»ƒä¹ </view>
          </view>
        </block>
      </scroll-view>

      <view class="section-title" style="margin-top:18rpx;"><text class="title-dot"></text>å¾®è¡ŒåŠ¨æ¸…å•</view>
      <view class="actions">
        <block tt:for="{{actions}}" tt:key="at">
          <view class="action-row">
            <view class="dot"></view>
            <text class="action-text">{{item.text}}</text>
            <text class="action-time">{{item.time}}</text>
          </view>
        </block>
      </view>
    </view>

    <!-- æœªæ¥ï¼šäººç‰©å…³ç³»å›¾è°± + äº‹ä»¶æ¸…å• -->
    <view tt:else class="section">
      <view class="section-title"><text class="title-dot"></text>äººç‰©å…³ç³»</view>
      <view class="graph-wrap">
        <canvas canvas-id="graph" id="graph"
        style="width:100%;height:600rpx;background:#fff;border:2rpx solid #e5e7eb;border-radius:20rpx;"></canvas>
      </view>

      <view class="card detail-card">
        <view class="section-title small">
          <text class="title-dot"></text>
          {{personTitle}}
        </view>

        <!-- äººç‰©ç®€ä»‹ -->
        <view class="person-detail">{{personInfo}}</view>

        <!-- äº‹ä»¶æ¸…å• -->
        <view class="section-title small" style="margin-top:10rpx;">
          <text class="title-dot"></text>ç›¸å…³äº‹ä»¶
        </view>

        <view tt:if="{{selectedEvents.length}}">
          <block tt:for="{{selectedEvents}}" tt:key="id">
            <view class="ev-row" data-id="{{item.id}}" bindtap="openEditEvent">
              <view class="ev-left">
                <view class="ev-time">{{item.time}}</view>
                <view class="ev-summary">{{item.summary}}</view>
                <view class="chips" style="margin-top:6rpx;">
                  <block tt:for="{{item.topics}}" tt:key="*this"><view class="chip">#{{item}}</view></block>
                </view>
              </view>
              <view class="ev-edit">ç¼–è¾‘</view>
            </view>
          </block>
        </view>
        <view tt:else class="subtle">æš‚æ— äº‹ä»¶ï¼Œç‚¹å‡»ä¸‹æ–¹â€œæ–°å¢äº‹ä»¶â€å¼€å§‹è®°å½•ã€‚</view>

        <view class="btn-row" style="margin-top:12rpx;">
          <view class="btn-ghost" bindtap="addEvent">æ–°å¢äº‹ä»¶</view>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨ç•™ç™½ï¼Œé¿å…è¢«å¯¼èˆªé®æŒ¡ -->
    <view style="height:120rpx"></view>
  </view>

  <!-- åº•éƒ¨å¯¼èˆªæ  -->
  <view class="bottom-nav">
    <view class="nav-item {{tab==='past'?'on':''}}" data-tab="past" bindtap="switchTab">
      <view class="nav-ico">â³</view><view class="nav-txt">è¿‡å»</view>
    </view>
    <view class="nav-item {{tab==='today'?'on':''}}" data-tab="today" bindtap="switchTab">
      <view class="nav-ico">ğŸŒ</view><view class="nav-txt">ä»Šå¤©</view>
    </view>
    <view class="nav-item {{tab==='future'?'on':''}}" data-tab="future" bindtap="switchTab">
      <view class="nav-ico">ğŸ”®</view><view class="nav-txt">æœªæ¥</view>
    </view>
  </view>

  <!-- äº‹ä»¶ç¼–è¾‘å¼¹å±‚ -->
  <view class="sheet {{showEditor?'show':''}}">
    <view class="inner">
      <view class="handle"></view>
      <view class="sheet-title">{{editor.isNew?'æ–°å¢äº‹ä»¶':'ç¼–è¾‘äº‹ä»¶'}}</view>

      <view class="form-row">
        <view class="label">æ—¶é—´</view>
        <input class="input" placeholder="ä¾‹å¦‚ï¼šä»Šå¤© 09:20 / 2025-08-15 09:20"
               value="{{editor.time}}" bindinput="onEditTime"/>
      </view>

      <view class="form-row">
        <view class="label">æ¦‚è¦</view>
        <textarea class="textarea" placeholder="ä¸€å¥è¯æè¿°å‘ç”Ÿäº†ä»€ä¹ˆ"
                  value="{{editor.summary}}" bindinput="onEditSummary"/>
      </view>

      <view class="form-row">
        <view class="label">è¯é¢˜</view>
        <input class="input" placeholder="#å·¥ä½œ #æ²Ÿé€šï¼ˆç”¨ç©ºæ ¼åˆ†éš”ï¼Œè‡ªåŠ¨å»é‡ï¼‰"
               value="{{editor.topicsText}}" bindinput="onEditTopics"/>
      </view>

      <view class="btn-row">
        <view class="btn-ghost" bindtap="cancelEdit">å–æ¶ˆ</view>
        <view class="btn-primary" bindtap="saveEvent">ä¿å­˜</view>
        <view class="btn-danger" tt:if="{{!editor.isNew}}" bindtap="deleteEvent">åˆ é™¤</view>
      </view>
    </view>
  </view>
</view>
