<view class="page">
    <!-- è°ƒè¯•æŒ‰é’® -->
    <view class="debug-btn" bindtap="goToDebug">ğŸ”§ è°ƒè¯•</view>
    
    <!-- å…³ç³»å›¾å¡ç‰‡ -->
    <view class="card">
      <view class="card-title">ğŸŒ äººç‰©å…³ç³»å›¾</view>
      <view class="graph-container">
        <ec-canvas id="my-chart-dom-graph" canvas-id="my-chart-dom-graph" ec="{{ ec }}" class="graph"></ec-canvas>
        <view class="graph-overlay" tt:if="{{persons.length === 0}}">
          <view class="overlay-content">
            <text class="overlay-icon">ğŸ‘¥</text>
            <text class="overlay-text">æš‚æ— äººç‰©å…³ç³»</text>
            <text class="overlay-desc">è®°å½•ä¸€äº›åŒ…å«äººç‰©çš„äº‹ä»¶ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨æ„å»ºå…³ç³»å›¾</text>
          </view>
        </view>
      </view>
      <view class="hint">ğŸ’¡ ç‚¹å‡»èŠ‚ç‚¹æŸ¥çœ‹äººç‰©è¯¦æƒ…ä¸ç›¸å…³äº‹ä»¶</view>
      <view class="graph-stats" tt:if="{{persons.length > 0}}">
        <view class="stat-item">
          <text class="stat-number">{{persons.length}}</text>
          <text class="stat-label">äººç‰©</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{totalEvents}}</text>
          <text class="stat-label">äº‹ä»¶</text>
        </view>
      </view>
    </view>
  
    <!-- äººç‰©ä¿¡æ¯å¡ç‰‡ -->
    <view class="card" tt:if="{{selectedPersonId}}">
      <view class="card-title-row">
        <view class="person-header">
          <view class="person-avatar">{{personAvatar}}</view>
          <view class="person-details">
            <view class="card-title">{{personTitle}}</view>
            <view class="person-subtitle">{{personSubtitle}}</view>
          </view>
        </view>
        <view class="person-actions">
          <button tt:if="{{selectedPersonId !== 'me'}}" class="primary" size="mini" bindtap="chatWithPerson">
            ğŸ’¬ ä¸TAå¯¹è¯
          </button>
          <button tt:if="{{selectedPersonId !== 'me'}}" class="secondary" size="mini" bindtap="viewPersonProfile">
            âš™ï¸ è§’è‰²è®¾å®š
          </button>
        </view>
      </view>
      <view class="person-info">{{personInfo}}</view>
    </view>
  
    <!-- äº‹ä»¶åˆ—è¡¨å¡ç‰‡ -->
    <view class="card">
      <view class="card-title-row">
        <view class="card-title">
          ğŸ“… ç›¸å…³äº‹ä»¶
          <text class="event-count" tt:if="{{selectedPersonId}}">({{selectedEvents.length}})</text>
        </view>
        <button size="mini" class="primary" bindtap="addEvent" tt:if="{{selectedPersonId}}">
          â• æ–°å¢äº‹ä»¶
        </button>
      </view>
  
      <view class="event-list" tt:if="{{selectedPersonId && selectedEvents.length > 0}}">
        <view class="event-item" tt:for="{{selectedEvents}}" tt:key="id" bindtap="viewEventDetail" data-event="{{item}}">
          <view class="event-timeline-dot"></view>
          <view class="event-main">
            <view class="event-header">
              <view class="event-time">{{item.createTime}}</view>
              <view class="event-status">{{item.status || 'å·²å®Œæˆ'}}</view>
            </view>
            <view class="event-summary">{{item.summary}}</view>
            <view class="event-topics" tt:if="{{item.topics && item.topics.length > 0}}">
              <text class="topic" tt:for="{{item.topics}}" tt:key="index">#{{item}}</text>
            </view>
            <view class="event-emotions" tt:if="{{item.emotions && item.emotions.length > 0}}">
              <text class="emotion" tt:for="{{item.emotions}}" tt:key="name">{{item.name}}</text>
            </view>
          </view>
        </view>
      </view>
  
      <view class="empty" tt:if="{{!selectedPersonId}}">
        <text class="empty-text">è¯·å…ˆç‚¹å‡»å…³ç³»å›¾é€‰æ‹©äººç‰©</text>
        <text class="empty-desc">é€‰æ‹©ä¸€ä¸ªäººç‰©èŠ‚ç‚¹æ¥æŸ¥çœ‹ç›¸å…³äº‹ä»¶</text>
      </view>
      
      <view class="empty" tt:if="{{selectedPersonId && selectedEvents.length===0}}">
        <text class="empty-text">æš‚æ— ç›¸å…³äº‹ä»¶</text>
        <text class="empty-desc">ç‚¹å‡»å³ä¸Šè§’"æ–°å¢äº‹ä»¶"æ¥æ·»åŠ ä¸{{personTitle}}ç›¸å…³çš„äº‹ä»¶</text>
      </view>
    </view>
    
    <!-- è§’è‰²è®¾å®šå¼¹çª— -->
    <view class="modal-overlay" tt:if="{{showProfileModal}}" bindtap="closeProfileModal">
      <view class="modal-content" catchtap="stopPropagation">
        <view class="modal-header">
          <text class="modal-title">ğŸ­ {{selectedPersonName}} çš„è§’è‰²è®¾å®š</text>
          <button class="modal-close" bindtap="closeProfileModal">âœ•</button>
        </view>
        <view class="modal-body">
          <view class="profile-section">
            <text class="section-title">AIç”Ÿæˆçš„è§’è‰²è®¾å®š</text>
            <textarea class="profile-textarea" value="{{aiGeneratedProfile}}" disabled></textarea>
          </view>
          <view class="profile-section">
            <text class="section-title">è‡ªå®šä¹‰è®¾å®š</text>
            <textarea class="profile-textarea" placeholder="åœ¨æ­¤è¾“å…¥æ‚¨å¯¹è¯¥è§’è‰²çš„è‡ªå®šä¹‰è®¾å®š..." value="{{customProfile}}" bindinput="onCustomProfileInput"></textarea>
          </view>
        </view>
        <view class="modal-footer">
          <button class="secondary" bindtap="regenerateProfile">ğŸ”„ é‡æ–°ç”Ÿæˆ</button>
          <button class="primary" bindtap="saveProfile">ğŸ’¾ ä¿å­˜è®¾å®š</button>
        </view>
      </view>
    </view>
  </view>